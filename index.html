<!DOCTYPE html>
<html style = "height: 100%;">
    <head>
        <meta charset="utf-8">
        <link href="index.css" rel="stylesheet">
    </head>
    <body style="margin: 0; padding: 0; height: 98%; overflow: hidden;">

        <!-- TimeLine Styling from knightlab -->
        <link title="timeline-styles" rel="stylesheet" 
        href="https://cdn.knightlab.com/libs/timeline3/latest/css/timeline.css">

         

        <!-- HTML object to put the timeline in -->
        <div id='timeline-embed' style="width: 100%; height: 100%"></div>


        <!-- JS dependencies -->
        <script src="https://cdn.knightlab.com/libs/timeline3/latest/js/timeline.js"></script>
       

        <!-- Main script to handle Timeline -->
        <script type="text/javascript">
            // The TL.Timeline constructor takes at least two arguments:
            // the id of the Timeline container (no '#'), and
            // the URL to your JSON data file or Google spreadsheet.
            // the id must refer to an element "above" this code,
            // and the element must have CSS styling to give it width and height
            // optionally, a third argument with configuration options can be passed.
            // See below for more about options.
            
            async function fetchDataAndBuildTimeline(){
                try{
                    const response = await fetch('/data');
                    console.log(response)
                    if (!response.ok){
                        throw new Error('Network response was not ok');
                    }
                    const data = await response.json();
                    console.log(data);
                    timeline = new TL.Timeline('timeline-embed', data);
                    console.log("timline created in index js");

                } catch (error){
                    console.error(error);
                }
            }
            
            fetchDataAndBuildTimeline()


            
            //New code for shutdown procedure Registers closing correctly, but does not show
            window.addEventListener('beforeunload', (event) => {
                event.preventDefault();
                fetch('/notify-close', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({message: 'Page is closing'}),

                });
            });
            


        </script>

    </body>
</html>
