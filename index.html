<!DOCTYPE html>
<html style = "height: 100%;">
    <head>
        <meta charset="utf-8">
        
    </head>
    <body style="margin: 0; padding: 0; height: 100%; overflow: hidden;">

        <!-- TimeLine Styling from knightlab -->
        <link title="timeline-styles" rel="stylesheet" 
        href="https://cdn.knightlab.com/libs/timeline3/latest/css/timeline.css">

         

        <!-- HTML object to put the timeline in -->
        <div id='timeline-embed' style="width: 100%; height: 100%"></div>


        <!-- JS dependencies -->
        <script src="https://cdn.knightlab.com/libs/timeline3/latest/js/timeline.js"></script>
       

        <!-- Main script to handle Timeline -->
        <script type="text/javascript">
            // The TL.Timeline constructor takes at least two arguments:
            // the id of the Timeline container (no '#'), and
            // the URL to your JSON data file or Google spreadsheet.
            // the id must refer to an element "above" this code,
            // and the element must have CSS styling to give it width and height
            // optionally, a third argument with configuration options can be passed.
            // See below for more about options.
            
            async function fetchDataAndBuildTimeline(){
                try{
                    const response = await fetch('/data');
                    console.log(response)
                    if (!response.ok){
                        throw new Error('Network response was not ok');
                    }
                    const data = await response.json();
                    console.log(data);
                    timeline = new TL.Timeline('timeline-embed', data);
                    console.log("timline created in index js");

                } catch (error){
                    console.error(error);
                }
            }
            
            fetchDataAndBuildTimeline()

            const autoScrollCooldown = 1; //(seconds)
            let countdownTimer;

            let forward = true;
            let Fbutton; 
            let Bbutton;

            // Function to start the countdown
            function startCountdown() {
                // Clear any previous countdown
                clearTimeout(countdownTimer);

                // Set a new countdown for 10 seconds
                countdownTimer = setTimeout(function () {
                // This code will execute if there's no interaction in 10 seconds
                console.log('No interaction detected for '+autoScrollCooldown+' seconds.');


                // Check movement decision
                // if moving forward, and forward is hidden move backwards
                // if moving backwards, and backward is hidden, move forward

                if (forward){
                    if (window.getComputedStyle(Fbutton).display === 'none') {
                        forward = false;
                    }
                } else {
                    if (window.getComputedStyle(Bbutton).display === 'none') {
                        forward = true;
                    }
                }
                

                // Simulate a click on the button
                if (forward){
                    Fbutton.click();
                } else {
                Bbutton.click();
                }

                }, 1000*autoScrollCooldown); // 10 seconds (10000 milliseconds)
            }

            // Add event listeners to detect interactions
            window.addEventListener('click', function () {
                console.log("click");
                Fbutton = document.querySelector('.tl-slidenav-next');
                Bbutton = document.querySelector('.tl-slidenav-previous');
                // Bbutton.click();
                // User clicked, so restart the countdown
                startCountdown();
            });

            window.addEventListener('keydown', function () {
                // User pressed a key, so restart the countdown
                startCountdown();
            });





            
            //New code for shutdown procedure Registers closing correctly, but does not show
            window.addEventListener('beforeunload', (event) => {
                event.preventDefault();
                fetch('/notify-close', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({message: 'Page is closing'}),

                });
            });
            


        </script>

    </body>
</html>
